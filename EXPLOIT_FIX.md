# Jump Exploit Fix

## The Problem

The agent discovered a reward hacking exploit:
- **Exploit**: Spam jump action infinitely to fly upward
- **Why it worked**: Jump had no cooldown or ground check
- **Result**: Agent reached goal height without using ledges
- **Reward**: ~116 per episode (but completely bogus)

## The Fix

### 1. Jump Mechanics (Realistic Physics)
- ✅ **Ground Check**: Jump only works when touching ground or ledge
- ✅ **Cooldown**: 5-step cooldown between jumps
- ✅ **Penalty**: -0.5 reward for trying to jump while airborne

### 2. Height Gain Rewards (Anti-Exploit)
- ✅ **Grounded Only**: Only reward height gain when grounded
- ✅ **Prevents Flying**: No reward for gaining height while airborne

### 3. Grab Mechanics (Proper Ledge Use)
- ✅ **Ledge Check**: Grab only works when touching a ledge
- ✅ **Bonus Reward**: +2.0 for successful grab on ledge
- ✅ **Encourages Strategy**: Agent must learn to use ledges

## Implementation Details

### New Properties
```javascript
this.canJump = true;
this.jumpCooldown = 0;
this.jumpCooldownSteps = 5;
```

### New Methods
```javascript
isGrounded() // Check if touching ground/ledge with low velocity
isTouchingLedge() // Check if in contact with any ledge
```

### Modified Actions
```javascript
// JUMP - Only when grounded, with cooldown
if (this.isGrounded() && this.jumpCooldown === 0) {
  applyJumpImpulse();
  this.jumpCooldown = 5;
}

// GRAB - Only when touching ledge
if (this.isTouchingLedge()) {
  applyGrabForce();
}
```

### Modified Rewards
```javascript
// Height gain - only when grounded
if (heightGain > 0 && this.isGrounded()) {
  reward += heightGain * 1.0;
}

// Failed jump penalty
if (action === JUMP && !isGrounded()) {
  reward -= 0.5;
}

// Ledge contact reward
if (isTouchingLedge()) {
  reward += 5.0;
}

// Successful grab bonus
if (action === GRAB && isTouchingLedge()) {
  reward += 2.0;
}
```

## What to Do Now

### 1. Reset the Exploited Model
The current model (v516) learned the exploit. You need to reset:

```javascript
// In browser console:
await window.climbingGame.modelManager.reset();
```

Or click the **"Reset All"** button in the UI.

### 2. Start Fresh Training
After reset:
1. Click "Start Training"
2. Agent will learn proper climbing mechanics
3. Should see:
   - Jump only when grounded
   - Use of ledges for climbing
   - Grab actions on ledges
   - Realistic climbing behavior

### 3. Expected Behavior

**Before Fix (Exploit):**
- Agent: Jump, Jump, Jump, Jump... (flying)
- Reward: ~116 (fake success)
- Ledges: Ignored
- Physics: Broken

**After Fix (Proper):**
- Agent: Move → Jump to ledge → Grab → Climb → Repeat
- Reward: Lower initially (learning), higher when mastered
- Ledges: Essential for climbing
- Physics: Realistic

## Expected Training Progress

### Early Episodes (0-100)
- Random exploration
- Learning jump timing
- Discovering ledges
- Reward: -50 to 20

### Mid Training (100-500)
- Using ledges occasionally
- Better jump timing
- Some successful climbs
- Reward: 20 to 60

### Late Training (500-1000+)
- Efficient ledge use
- Optimal climbing paths
- High success rate
- Reward: 60 to 100+

## Verification

To verify the fix is working, watch for:
1. ✅ Agent only jumps when on ground/ledge
2. ✅ Agent can't spam jump to fly
3. ✅ Agent uses ledges to climb
4. ✅ Grab action used on ledges
5. ✅ Realistic climbing motion

## Technical Notes

### Why the Exploit Happened
1. **No Physics Constraints**: Jump worked anytime
2. **Reward Hacking**: Height gain rewarded regardless of method
3. **Optimal Strategy**: Spamming jump was easiest path to goal
4. **RL Found It**: Agent optimized for reward, not realism

### Why the Fix Works
1. **Physics Constraints**: Jump requires ground contact
2. **Reward Alignment**: Only reward legitimate climbing
3. **Penalty System**: Discourage exploit attempts
4. **Bonus Rewards**: Encourage proper ledge use

### Future Improvements
- Add stamina system (limited jumps)
- Require specific grab timing
- Add ledge-specific grab zones
- Implement climbing animations
- Add wall friction/sliding
